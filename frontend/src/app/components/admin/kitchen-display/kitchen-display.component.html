<div class="container">
    <div class="page-header">
        <h1>Kitchen Display</h1>
        <div class="action-buttons">
            <button mat-raised-button color="primary" (click)="loadOrders()">
                <mat-icon>refresh</mat-icon> Refresh
            </button>
            <a mat-raised-button routerLink="/admin/orders">
                <mat-icon>receipt_long</mat-icon> Order Management
            </a>
        </div>
    </div>

    <div *ngIf="loading" class="loading-spinner">
        <mat-spinner></mat-spinner>
    </div>

    <div *ngIf="error" class="error-message">
        {{ error }}
    </div>

    <div *ngIf="!loading && !error" class="kitchen-display">
        <div class="order-columns">
            <div class="order-column">
                <div class="column-header pending">
                    <h2>Pending Orders ({{ pendingOrders.length }})</h2>
                </div>
                <div class="column-content">
                    <mat-card *ngFor="let order of pendingOrders" class="order-card">
                        <mat-card-header>
                            <mat-card-title>Order #{{ order.orderNumber }}</mat-card-title>
                            <mat-card-subtitle>
                                {{ order.createdAt | date:'short' }} - {{ order.orderType | titlecase }}
                            </mat-card-subtitle>
                        </mat-card-header>
                        <mat-card-content>
                            <div class="order-details">
                                <div *ngIf="order.orderType === 'dine-in' && order.orderDetails?.dineIn"
                                    class="order-info">
                                    <strong>Table:</strong> {{ order.orderDetails.dineIn.tableNumber }}
                                </div>
                                <div *ngIf="order.orderType === 'takeaway' && order.orderDetails?.takeaway"
                                    class="order-info">
                                    <strong>Pickup:</strong> {{ order.orderDetails.takeaway.pickupTime |
                                    date:'shortTime' }}
                                </div>
                                <div *ngIf="order.orderType === 'room-service' && order.orderDetails?.roomService"
                                    class="order-info">
                                    <strong>Room:</strong> {{ order.orderDetails.roomService.roomNumber }}
                                </div>
                            </div>

                            <div class="order-items">
                                <div *ngFor="let item of order.items" class="order-item">
                                    <div class="item-quantity">{{ item.quantity }}x</div>
                                    <div class="item-details">
                                        <div class="item-name">{{ item.name }} {{ item.variant ? '(' + item.variant.name
                                            + ')' : '' }}</div>
                                        <div *ngIf="item.addons && item.addons.length > 0" class="item-addons">
                                            <div *ngFor="let addon of item.addons" class="item-addon">
                                                + {{ addon.option.name }}
                                            </div>
                                        </div>
                                        <div *ngIf="item.specialInstructions" class="item-instructions">
                                            <em>{{ item.specialInstructions }}</em>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div *ngIf="order.specialInstructions" class="special-instructions">
                                <strong>Special Instructions:</strong> {{ order.specialInstructions }}
                            </div>
                        </mat-card-content>
                        <mat-card-actions>
                            <button mat-raised-button color="primary" (click)="updateOrderStatus(order, 'preparing')">
                                <mat-icon>restaurant</mat-icon> Start Preparing
                            </button>
                            <button mat-button (click)="printKOT(order)">
                                <mat-icon>print</mat-icon> Print KOT
                            </button>
                        </mat-card-actions>
                    </mat-card>

                    <div *ngIf="pendingOrders.length === 0" class="no-orders">
                        <p>No pending orders</p>
                    </div>
                </div>
            </div>

            <div class="order-column">
                <div class="column-header preparing">
                    <h2>Preparing ({{ preparingOrders.length }})</h2>
                </div>
                <div class="column-content">
                    <mat-card *ngFor="let order of preparingOrders" class="order-card">
                        <mat-card-header>
                            <mat-card-title>Order #{{ order.orderNumber }}</mat-card-title>
                            <mat-card-subtitle>
                                {{ order.createdAt | date:'short' }} - {{ order.orderType | titlecase }}
                            </mat-card-subtitle>
                        </mat-card-header>
                        <mat-card-content>
                            <div class="order-details">
                                <div *ngIf="order.orderType === 'dine-in' && order.orderDetails?.dineIn"
                                    class="order-info">
                                    <strong>Table:</strong> {{ order.orderDetails.dineIn.tableNumber }}
                                </div>
                                <div *ngIf="order.orderType === 'takeaway' && order.orderDetails?.takeaway"
                                    class="order-info">
                                    <strong>Pickup:</strong> {{ order.orderDetails.takeaway.pickupTime |
                                    date:'shortTime' }}
                                </div>
                                <div *ngIf="order.orderType === 'room-service' && order.orderDetails?.roomService"
                                    class="order-info">
                                    <strong>Room:</strong> {{ order.orderDetails.roomService.roomNumber }}
                                </div>
                            </div>

                            <div class="order-items">
                                <div *ngFor="let item of order.items" class="order-item">
                                    <div class="item-quantity">{{ item.quantity }}x</div>
                                    <div class="item-details">
                                        <div class="item-name">{{ item.name }} {{ item.variant ? '(' + item.variant.name
                                            + ')' : '' }}</div>
                                        <div *ngIf="item.addons && item.addons.length > 0" class="item-addons">
                                            <div *ngFor="let addon of item.addons" class="item-addon">
                                                + {{ addon.option.name }}
                                            </div>
                                        </div>
                                        <div *ngIf="item.specialInstructions" class="item-instructions">
                                            <em>{{ item.specialInstructions }}</em>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div *ngIf="order.specialInstructions" class="special-instructions">
                                <strong>Special Instructions:</strong> {{ order.specialInstructions }}
                            </div>
                        </mat-card-content>
                        <mat-card-actions>
                            <button mat-raised-button color="accent" (click)="updateOrderStatus(order, 'ready')">
                                <mat-icon>done_all</mat-icon> Mark as Ready
                            </button>
                            <button mat-button (click)="printKOT(order)">
                                <mat-icon>print</mat-icon> Print KOT
                            </button>
                        </mat-card-actions>
                    </mat-card>

                    <div *ngIf="preparingOrders.length === 0" class="no-orders">
                        <p>No orders being prepared</p>
                    </div>
                </div>
            </div>

            <div class="order-column">
                <div class="column-header ready">
                    <h2>Ready ({{ readyOrders.length }})</h2>
                </div>
                <div class="column-content">
                    <mat-card *ngFor="let order of readyOrders" class="order-card">
                        <mat-card-header>
                            <mat-card-title>Order #{{ order.orderNumber }}</mat-card-title>
                            <mat-card-subtitle>
                                {{ order.createdAt | date:'short' }} - {{ order.orderType | titlecase }}
                            </mat-card-subtitle>
                        </mat-card-header>
                        <mat-card-content>
                            <div class="order-details">
                                <div *ngIf="order.orderType === 'dine-in' && order.orderDetails?.dineIn"
                                    class="order-info">
                                    <strong>Table:</strong> {{ order.orderDetails.dineIn.tableNumber }}
                                </div>
                                <div *ngIf="order.orderType === 'takeaway' && order.orderDetails?.takeaway"
                                    class="order-info">
                                    <strong>Pickup:</strong> {{ order.orderDetails.takeaway.pickupTime |
                                    date:'shortTime' }}
                                </div>
                                <div *ngIf="order.orderType === 'room-service' && order.orderDetails?.roomService"
                                    class="order-info">
                                    <strong>Room:</strong> {{ order.orderDetails.roomService.roomNumber }}
                                </div>
                            </div>

                            <div class="order-items">
                                <div *ngFor="let item of order.items" class="order-item">
                                    <div class="item-quantity">{{ item.quantity }}x</div>
                                    <div class="item-details">
                                        <div class="item-name">{{ item.name }} {{ item.variant ? '(' + item.variant.name
                                            + ')' : '' }}</div>
                                        <div *ngIf="item.addons && item.addons.length > 0" class="item-addons">
                                            <div *ngFor="let addon of item.addons" class="item-addon">
                                                + {{ addon.option.name }}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </mat-card-content>
                        <mat-card-actions>
                            <button mat-raised-button color="primary" (click)="updateOrderStatus(order, 'completed')">
                                <mat-icon>task_alt</mat-icon> Complete Order
                            </button>
                            <button mat-button *ngIf="order.orderType === 'delivery'"
                                (click)="updateOrderStatus(order, 'out-for-delivery')">
                                <mat-icon>delivery_dining</mat-icon> Out for Delivery
                            </button>
                        </mat-card-actions>
                    </mat-card>

                    <div *ngIf="readyOrders.length === 0" class="no-orders">
                        <p>No orders ready for pickup/delivery</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>